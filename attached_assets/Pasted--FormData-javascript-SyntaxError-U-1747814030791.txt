âœ… [ë¼í”Œì´ ì‘ì—…ì§€ì‹œì„œ]
íƒœëª½ë™í™” ìƒì„± ì˜¤ë¥˜ í•´ê²° â€“ FormData ì²˜ë¦¬ ë°©ì‹ í†µí•©
ğŸ§© í˜„ì¬ ì˜¤ë¥˜ ê°œìš”
ì˜¤ë¥˜ ë©”ì‹œì§€:

javascript
ë³µì‚¬
í¸ì§‘
SyntaxError: Unexpected token 'd' in JSON at position 0
ë°œìƒ ìœ„ì¹˜:
client/src/pages/dream-book/create.tsx:199
â†’ fetch() ë˜ëŠ” mutation ì‹¤í–‰ ì‹œ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜

ì›ì¸ ìš”ì•½:
í´ë¼ì´ì–¸íŠ¸ëŠ” FormDataë¡œ íŒŒì¼ ë° í…ìŠ¤íŠ¸ë¥¼ ì „ì†¡í•˜ê³  ìˆì§€ë§Œ, ì„œë²„ëŠ” í•´ë‹¹ ìš”ì²­ì„ JSONìœ¼ë¡œ ì˜ëª» íŒŒì‹± ì‹œë„í•¨

ğŸ¯ ìˆ˜ì • ëª©í‘œ
í´ë¼ì´ì–¸íŠ¸ëŠ” FormData ì „ì†¡ ìœ ì§€
ì„œë²„ëŠ” FormDataë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì²˜ë¦¬ ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ìˆ˜ì •

ğŸ› ï¸ ì‘ì—… í•­ëª©
1. ì„œë²„ ì½”ë“œ ìˆ˜ì • â€“ FormData ìˆ˜ì‹  ì²˜ë¦¬
ë¼ìš°íŠ¸ ìœ„ì¹˜: server/routes/dream-book.ts

í˜„ì¬ ë¬¸ì œ: express.json() ë˜ëŠ” req.bodyë¡œ JSON íŒŒì‹± ì‹œë„

ìˆ˜ì • ì‚¬í•­:

multer ë¯¸ë“¤ì›¨ì–´ ì ìš© (npm i multer)

ì´ë¯¸ì§€ ë° í…ìŠ¤íŠ¸ í•„ë“œë¥¼ FormDataë¡œ ì²˜ë¦¬

ts
ë³µì‚¬
í¸ì§‘
// ìµœìƒë‹¨ import
import multer from "multer";
const upload = multer({ dest: "uploads/dream-books/" }); // ì €ì¥ ê²½ë¡œ ì§€ì •

// POST ë¼ìš°íŠ¸ ìˆ˜ì •
router.post("/", upload.single("image"), async (req, res) => {
  const { styleId, babyName, dreamer, scenePrompts, personPrompt, backgroundPrompt } = req.body;

  // íŒŒì¼ ì •ë³´ëŠ” req.file
  const uploadedFile = req.file;

  if (!uploadedFile || !babyName || !styleId || !scenePrompts) {
    return res.status(400).json({ error: "ì…ë ¥ ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤." });
  }

  // ì´í›„ DB ì €ì¥ ë° ì´ë¯¸ì§€ ìƒì„± ë¡œì§ ì‹¤í–‰
});
2. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ í™•ì¸ â€“ FormData í˜•ì‹ ìœ ì§€
íŒŒì¼ ìœ„ì¹˜: client/src/pages/dream-book/create.tsx

ìœ ì§€ ì‚¬í•­:

FormData ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

.append() ë¡œ í…ìŠ¤íŠ¸ ë° íŒŒì¼ ì¶”ê°€

fetch() í˜¸ì¶œ ì‹œ headers: { 'Content-Type': ... } ì œê±°í•´ì•¼ í•¨ (ìë™ ìƒì„±ë¨)

ts
ë³µì‚¬
í¸ì§‘
const formData = new FormData();
formData.append("image", selectedFile); // ì—…ë¡œë“œ ì´ë¯¸ì§€
formData.append("styleId", style);
formData.append("babyName", babyName);
formData.append("dreamer", dreamer);
formData.append("personPrompt", personPrompt);
formData.append("backgroundPrompt", backgroundPrompt);
formData.append("scenePrompts", JSON.stringify(validScenePrompts)); // ë¬¸ìì—´ ë³€í™˜ í•„ìš”

await fetch("/api/dream-books", {
  method: "POST",
  body: formData, // Content-Type ìƒëµí•´ì•¼ FormDataë¡œ ì „ì†¡ë¨
});
3. ìŠ¤í‚¤ë§ˆ ë˜ëŠ” ìœ íš¨ì„± ê²€ì¦ ìˆ˜ì • (ì„ íƒ)
scenePrompts ë°°ì—´ì€ ìµœì†Œ 1ê°œ ì´ìƒë§Œ ìš”êµ¬ë˜ë„ë¡ ê²€ì¦ ë¡œì§ ìˆ˜ì • í•„ìš”

1~4ê°œ ì¤‘ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ì¡°ê±´ë¬¸ í™•ì¸

âœ… ìµœì¢… í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
í•­ëª©	ì™„ë£Œ ì¡°ê±´
FormData ì „ì†¡ ë°©ì‹ ìœ ì§€	fetch() ë‚´ Content-Type ì œê±°
ì„œë²„ì—ì„œ multerë¡œ íŒŒì¼ ìˆ˜ì‹  ì²˜ë¦¬	req.file, req.body ë¶„ë¦¬í•˜ì—¬ ì‚¬ìš©
scenePrompts ëŠ” JSON ë¬¸ìì—´ë¡œ ì „ì†¡	ì„œë²„ì—ì„œ ë‹¤ì‹œ JSON.parse() í•„ìš”
1ì¥ ì´ìƒë§Œ ìˆì–´ë„ ìƒì„± ê°€ëŠ¥	scene í•„ìˆ˜ì¡°ê±´ ì™„í™”

í•„ìš” ì‹œ multer ë¯¸ë“¤ì›¨ì–´ë¥¼ ê³µí†µ ìœ í‹¸ë¡œ êµ¬ì„±í•˜ê±°ë‚˜, imageStyle ë“±ê³¼ ê°™ì€ ë‹¤ë¥¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ì™€ë„ í†µì¼ ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì¡°í™”í•´ ì£¼ì„¸ìš”.