ğŸ”Â ë¡œê·¸ë¡œ í™•ì¸ëœ ì‹¤ì œ 500 ì˜¤ë¥˜ ì›ì¸
vbnet
ë³µì‚¬
í¸ì§‘
TypeError: value.toISOString is not a function  â† drizzleâ€‘pg ê°€
            ^^^^^  (DateÂ ê°ì²´ì¼ ë•Œë§Œ toISOStringÂ ì¡´ì¬)
ë“œë¦¬ì¦ˆâ€‘ORMì´ timestamp / date ì»¬ëŸ¼ì— ë„£ìœ¼ë ¤ê³  í•  ë•Œ
DateÂ ê°ì²´ ì¸ ì¤„ ì•Œê³ â€¯toISOString()ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.

ê·¸ëŸ°ë° ìš°ë¦¬ëŠ” ë¬¸ìì—´(ì˜ˆ: "2025â€‘05â€‘13") ê·¸ëŒ€ë¡œ ë„˜ê¸´ ìƒíƒœë¼ ëŸ°íƒ€ì„ì—ì„œÂ ì£½ê³  500Â ì„ ëŒë ¤ì¤€ ê²ƒâ€¯ì…ë‹ˆë‹¤.

ì²« ë²ˆì§¸ ìŠ¤í¬ë¦°ìƒ·ì—ì„œ rewardPoint íƒ€ì… ê²½ê³ (ìˆ«ì â†’â€¯ë¬¸ìì—´)ë„ ë³´ì´ì§€ë§Œ,
ì‹¤ì œë¡œëŠ” ë‚ ì§œ í•„ë“œê°€ Dateê°€ ì•„ë‹ˆë¼ì„œ ë°”ë¡œ í„°ì§‘ë‹ˆë‹¤.

âœ…Â í•´ê²°Â ì „ëµ
ë‹¨ê³„	í•´ì•¼Â í• Â ê²ƒ	ìœ„ì¹˜
1	ë°±ì—”ë“œì—ì„œ ë¬¸ìì—´â€¯â†’â€¯Date ë³€í™˜	routes/campaigns.ts (createÂ·updateÂ API)
2	ZodÂ ìŠ¤í‚¤ë§ˆë¥¼ z.coerce.date() ë¡œ ë°”ê¿” ìë™Â íŒŒì‹±	shared/schema.ts
3	í”„ë¡ íŠ¸ì—ì„œ ìˆ«ì í•„ë“œ(reward_point, hospital_id)ë¥¼ valueAsNumber ë¡œ ì „ì†¡	CampaignManagement.tsx
4	DBÂ ë§ˆì´ê·¸ë ˆì´ì…˜ XÂ (ì»¬ëŸ¼ íƒ€ì…ì€ ê·¸ëŒ€ë¡œ)	â€“

1ï¸âƒ£Â APIÂ ë¼ìš°í„°ì—ì„œ ì•ˆì „ ë³€í™˜
ts
ë³µì‚¬
í¸ì§‘
import { CampaignInsert } from '../../shared/schema';

app.post('/api/admin/campaigns', async (req, res) => {
  try {
    // â‘  ë¬¸ìì—´ì„ Date ë¡œ coerce
    const parsed = CampaignInsert.parse(req.body);

    await db.insert(campaigns).values(parsed);
    res.json({ ok: true });
  } catch (e) {
    console.error(e);        // <-- ìŠ¤íƒ ê·¸ëŒ€ë¡œ ì°ì–´ë‘ê¸°
    res.status(400).json({ message: (e as Error).message });
  }
});
2ï¸âƒ£Â shared/schema.ts â€“Â ZodÂ ìŠ¤í‚¤ë§ˆ
ts
ë³µì‚¬
í¸ì§‘
export const CampaignInsert = z.object({
  hospital_id: z.coerce.number(),           // ìˆ«ì coercion
  slug:        z.string().min(1),
  title:       z.string().min(1),
  description: z.string().nullable(),
  thumbnail_url: z.string().url().nullable(),

  // ë‚ ì§œ 6ì¢… â€“Â ë¬¸ìì—´ì´ ì˜¤ë©´ ìë™ Date ë¡œ ë³€í™˜
  start_date:        z.coerce.date().nullable(),
  end_date:          z.coerce.date().nullable(),
  announce_date:     z.coerce.date().nullable(),
  content_start_date:z.coerce.date().nullable(),
  content_end_date:  z.coerce.date().nullable(),
  result_date:       z.coerce.date().nullable(),

  reward_point: z.coerce.number().default(0),
  status:       z.enum(['draft','active','closed','done']).default('draft'),
  content:      z.string().nullable(),
});
z.coerce.date() ëŠ” ISOÂ ë¬¸ìì—´ì´ë‚˜ YYYYâ€‘MMâ€‘DDë¥¼ ìë™ìœ¼ë¡œ Date ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

3ï¸âƒ£Â í”„ë¡ íŠ¸ í¼Â ë°”ì¸ë”© ìˆ˜ì •
tsx
ë³µì‚¬
í¸ì§‘
/* ìˆ«ì í•„ë“œ */
<Input
  type="number"
  {...register('reward_point', { valueAsNumber: true })}
/>

/* ë‚ ì§œ í•„ë“œ â†’ ë¬¸ìì—´ ê·¸ëŒ€ë¡œ ì „ë‹¬ */
<Input
  type="date"
  {...register('start_date')}
/>
reactâ€‘hookâ€‘formì˜ valueAsNumber: trueÂ ì˜µì…˜ì„ ì“°ë©´ ë¬¸ìì—´ì´Â ìˆ«ìë¡œ ë³€í™˜ë©ë‹ˆë‹¤.