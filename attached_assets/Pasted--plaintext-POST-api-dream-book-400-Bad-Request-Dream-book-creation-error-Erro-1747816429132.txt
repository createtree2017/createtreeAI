âœ… í˜„ì¬ ì˜¤ë¥˜ ë¡œê·¸ ìš”ì•½
plaintext
ë³µì‚¬
í¸ì§‘
POST /api/dream-book 400 (Bad Request)
Dream book creation error: Error: íƒœëª½ë™í™” ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤
scenePrompts = [
 "ì—„ë§ˆë°°ë¥¼ ì•ˆê²¨ í™˜í•˜ê²Œ ì›ƒëŠ” ì•„ê¸°",
 ...
]
â†’ FormData êµ¬ì„±ì€ ì˜ ë˜ì–´ ìˆê³ , í´ë¼ì´ì–¸íŠ¸ ë¡œê·¸ì—ì„œë„ scenePromptsê°€ string ë°°ì—´ë¡œ ì •ìƒ ì „ì†¡ë˜ê³  ìˆìŒì„ í™•ì¸í–ˆìŒ.
ê·¸ëŸ¼ì—ë„ 400 ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ëŠ” ê²ƒì€ Zod ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

ğŸ” ì›ì¸ ì •ë¦¬
êµ¬ë¶„	ì›ì¸
1	ì„œë²„ì—ì„œ scenePromptsë¥¼ JSON.parse()í•œ í›„ì—ë„, Zod ìŠ¤í‚¤ë§ˆì— ë°˜ì˜ë˜ëŠ” ë°ì´í„° ê°ì²´ê°€ req.bodyë¥¼ ê·¸ëŒ€ë¡œ ì°¸ì¡°í•¨
2	ì¦‰, parsedScenePromptsëŠ” ì˜ ë§Œë“¤ì–´ì¡Œì§€ë§Œ req.body.scenePromptsëŠ” ì—¬ì „íˆ string ìƒíƒœ
3	createDreamBookSchema.parse(req.body) í˜¹ì€ safeParse(req.body)ê°€ string[]ì´ ì•„ë‹ˆë¼ stringìœ¼ë¡œ ì¸ì‹í•´ì„œ ì‹¤íŒ¨
4	ë”°ë¡œ ë§Œë“  parsedScenePromptsë¥¼ ì‚¬ìš©í•œ ìƒˆ ê°ì²´ë¡œ validateí•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸

ğŸ›  ìµœì¢… í•´ê²° ë°©ë²•
ğŸ”§ ì„œë²„ ì½”ë“œ(server/routes/dream-book.ts)
ts
ë³µì‚¬
í¸ì§‘
import { createDreamBookSchema } from "@/shared/dream-book";

// ê¸°ì¡´ FormData í•„ë“œ
const {
  babyName,
  dreamer,
  styleId,
  characterImageUrl,
  peoplePrompt,
  backgroundPrompt,
} = req.body;

// scenePromptsë§Œ ë”°ë¡œ JSON íŒŒì‹±
let scenePrompts: string[] = [];
try {
  scenePrompts = JSON.parse(req.body.scenePrompts || "[]");
} catch (err) {
  return res.status(400).json({ error: "scenePrompts í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤." });
}

// âœ… ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•œ ì™„ì „í•œ ê°ì²´ ìƒì„±
const validatedData = {
  babyName,
  dreamer,
  styleId,
  characterImageUrl,
  peoplePrompt,
  backgroundPrompt,
  scenePrompts, // ì—¬ê¸°ì— ì§ì ‘ íŒŒì‹±í•œ ë°°ì—´ ë„£ê¸°!
};

// Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦
const validation = createDreamBookSchema.safeParse(validatedData);
if (!validation.success) {
  console.error("ğŸ›‘ Zod ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨", validation.error.flatten());
  return res.status(400).json({ error: "ì…ë ¥ê°’ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤" });
}
ğŸ“¦ ë¼í”Œì´ ì‘ì—…ì§€ì‹œì„œ
txt
ë³µì‚¬
í¸ì§‘
[ì‘ì—…ì§€ì‹œì„œ: íƒœëª½ë™í™” ìƒì„± ì˜¤ë¥˜ ìˆ˜ì • - scenePrompts Zod ê²€ì¦ ì‹¤íŒ¨ ë¬¸ì œ]

ğŸ“Œ ëª©ì 
íƒœëª½ë™í™” ìƒì„± ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ FormDataë¡œ ì „ë‹¬ëœ scenePromptsë¥¼ ì„œë²„ì—ì„œ íŒŒì‹±í•œ í›„, Zod ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì¦ê¹Œì§€ ì˜¬ë°”ë¥´ê²Œ í†µê³¼í•˜ë„ë¡ ìˆ˜ì •

ğŸ§© ë°œìƒ ì›ì¸
- í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” scenePromptsë¥¼ JSON.stringifyëœ stringìœ¼ë¡œ ì „ì†¡
- ì„œë²„ì—ì„œëŠ” JSON.parse()ë¥¼ í•˜ê¸´ í–ˆì§€ë§Œ, Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦ ì‹œ req.body.scenePrompts (string)ë¡œ ê·¸ëŒ€ë¡œ ê²€ì¦
- ë”°ë¼ì„œ Zodì—ì„œ íƒ€ì… ë¶ˆì¼ì¹˜ ì˜¤ë¥˜ ë°œìƒ â†’ 400 Bad Request

ğŸ›  ìˆ˜ì • ì§€ì¹¨

1. server/routes/dream-book.ts ë‚´ scenePrompts ì²˜ë¦¬
- JSON.parse()ë¡œ ë°°ì—´ë¡œ ë³€í™˜
- ì—ëŸ¬ ë°œìƒ ì‹œ 400 ì‘ë‹µ

```ts
let scenePrompts: string[] = [];
try {
  scenePrompts = JSON.parse(req.body.scenePrompts || "[]");
} catch (err) {
  return res.status(400).json({ error: "scenePrompts í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤." });
}
ìœ íš¨ì„± ê²€ì¦ ì „ validatedData ê°ì²´ ìƒì„±

ts
ë³µì‚¬
í¸ì§‘
const validatedData = {
  ...req.body,
  scenePrompts,
};
createDreamBookSchema.safeParse(validatedData) ë¡œ ê²€ì¦

ì‹¤íŒ¨ ì‹œ ìƒì„¸í•œ console.error ì¶œë ¥ ë° 400 ì‘ë‹µ

âœ… ì°¸ê³ : ê¸°ì¡´ req.body ê·¸ëŒ€ë¡œ validateí•˜ì§€ ë§ê³ , scenePromptsë¥¼ ë°”ê¾¼ ìƒˆ ê°ì²´ validatedDataë¥¼ Zodì— ë„˜ê²¨ì•¼ í•¨