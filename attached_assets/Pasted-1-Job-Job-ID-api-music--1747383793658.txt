1. ì›Œí¬í”Œë¡œìš° ì „í™˜: ì¦‰ì‹œ Job ë°œê¸‰ + ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬
ìŒì•… ìƒì„± ìš”ì²­ â†’ Job ID ë°˜í™˜
í´ë¼ì´ì–¸íŠ¸ê°€ /api/music ê°™ì€ ì—”ë“œí¬ì¸íŠ¸ë¡œ ìƒì„± ìš”ì²­ì„ ë³´ë‚´ë©´, ì„œë²„ëŠ” ì¦‰ì‹œ jobId ë§Œ ë°˜í™˜í•˜ê³  ë‚´ë¶€ì—ì„œëŠ” ë¹„ë™ê¸°ë¡œ ìŒì•…ì„ ë§Œë“œëŠ” êµ¬ì¡°ë¡œ ë°”ê¿‰ë‹ˆë‹¤.

js
ë³µì‚¬
í¸ì§‘
// server/routes/music.js (Express ì˜ˆì‹œ)
router.post("/", async (req, res) => {
  const jobId = await musicService.enqueueMusicJob(req.body);
  res.json({ jobId });
});

router.get("/:jobId/status", async (req, res) => {
  const status = await musicService.getJobStatus(req.params.jobId);
  res.json(status); // { state: "pending"|"processing"|"done"|"error", resultUrl? }
});
í´ë¼ì´ì–¸íŠ¸ì—ì„  Job IDë§Œ ì €ì¥

localStorage.setItem("musicJobId", jobId);

ì „ì—­ ìƒíƒœ(Context/Redux ë“±)ì—ë„ ê°™ì€ ê°’ì„ ë„£ì–´ ë‘¡ë‹ˆë‹¤.

App ìµœìƒìœ„ì—ì„œ í´ë§ ë¡œì§ ê°€ë™
/ ë£¨íŠ¸ì— ê°ì‹¼ MusicJobProvider ì•ˆì—ì„œ, useEffect(() â‡’ { â€¦ }, []) ë¹ˆ ë°°ì—´(deps)ë¡œ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ëŠ” í´ë§ íƒ€ì´ë¨¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.

jsx
ë³µì‚¬
í¸ì§‘
// client/src/lib/MusicJobContext.jsx
import { createContext, useContext, useEffect, useState } from "react";
import axios from "axios";

const MusicJobContext = createContext();
export function useMusicJob() { return useContext(MusicJobContext); }

export function MusicJobProvider({ children }) {
  const [jobId, setJobId] = useState(() => localStorage.getItem("musicJobId"));
  const [status, setStatus] = useState("idle"); // idle, pending, processing, done, error
  const [resultUrl, setResultUrl] = useState(null);

  useEffect(() => {
    if (!jobId) return;
    let timer = setInterval(async () => {
      try {
        const { data } = await axios.get(`/api/music/${jobId}/status`);
        setStatus(data.state);
        if (data.state === "done") {
          setResultUrl(data.resultUrl);
          clearInterval(timer);
        }
        if (data.state === "error") {
          clearInterval(timer);
        }
      } catch {
        clearInterval(timer);
        setStatus("error");
      }
    }, 2000);
    return () => clearInterval(timer);
  }, [jobId]);

  const startJob = async (params) => {
    const { data } = await axios.post("/api/music", params);
    localStorage.setItem("musicJobId", data.jobId);
    setJobId(data.jobId);
    setStatus("pending");
    setResultUrl(null);
  };

  return (
    <MusicJobContext.Provider value={{ jobId, status, resultUrl, startJob }}>
      {children}
    </MusicJobContext.Provider>
  );
}
App ìµœìƒë‹¨ì— Provider ì„¤ì •

jsx
ë³µì‚¬
í¸ì§‘
// client/src/App.jsx
import { MusicJobProvider } from "./lib/MusicJobContext";
import Header from "./components/Header";
import Routes from "./Routes";

function App() {
  return (
    <MusicJobProvider>
      <Header />     {/* ì—¬ê¸°ì„œ ì „ì—­ ì§„í–‰ ìƒíƒœ í‘œì‹œ */}
      <Routes />
    </MusicJobProvider>
  );
}
export default App;
Header í˜¹ì€ ì „ì—­ Indicator

jsx
ë³µì‚¬
í¸ì§‘
// client/src/components/MusicIndicator.jsx
import { useMusicJob } from "../lib/MusicJobContext";

export default function MusicIndicator() {
  const { status } = useMusicJob();
  if (status === "idle" || status === "done") return null;
  return (
    <div className="music-indicator">
      ğŸµ ìŒì•… ìƒì„± ì¤‘â€¦ ({status})
    </div>
  );
}
ìŒì•… ìƒì„± í˜ì´ì§€ì—ì„œ startJob í˜¸ì¶œ

jsx
ë³µì‚¬
í¸ì§‘
// client/src/pages/MusicPage.jsx
import { useState } from "react";
import { useMusicJob } from "../lib/MusicJobContext";

export default function MusicPage() {
  const [prompt, setPrompt] = useState("");
  const { status, resultUrl, startJob } = useMusicJob();

  const handleSubmit = e => {
    e.preventDefault();
    startJob({ prompt });
  };

  return (
    <form onSubmit={handleSubmit}>
      <textarea value={prompt} onChange={e=>setPrompt(e.target.value)} />
      <button disabled={status==="pending"||status==="processing"}>
        ìƒì„± ì‹œì‘
      </button>
      {status==="processing" && <p>ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒì„± ì¤‘â€¦</p>}
      {status==="done" && <audio src={resultUrl} controls autoPlay />}
    </form>
  );
}
ì´ë ‡ê²Œ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ì´ìœ 
Job ID ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬: ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë¼ë„ ì„œë²„ ìª½ ì‘ì—…ì€ ê³„ì†ë˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì–¸ì œë“  jobId ë¡œ ìƒíƒœë¥¼ ì¡°íšŒ(polling)ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

Provider ë ˆë²¨ í´ë§: MusicPageê°€ ì•„ë‹Œ ë‹¤ë¥¸ íƒ­Â·í˜ì´ì§€ë¡œ ì´ë™í•´ë„ MusicJobProvider ëŠ” ì‚¬ë¼ì§€ì§€ ì•Šìœ¼ë¯€ë¡œ í´ë§ì´ ëŠê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤.

ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥: ìƒˆë¡œê³ ì¹¨Â·ë‹¤ë¥¸ íƒ­ ë³µê·€ í›„ì—ë„ jobId ì™€ status ê°€ ìœ ì§€ë©ë‹ˆë‹¤.

ì „ì—­ Indicator: í—¤ë”ë‚˜ ê³µí†µ ë ˆì´ì•„ì›ƒ ì˜ì—­ì— â€œìƒì„± ì¤‘â€ í‘œì‹œë¥¼ ë„ì›Œ ë†“ìœ¼ë©´, ì‚¬ìš©ìì—ê²Œ ì‘ì—…ì´ ì—¬ì „íˆ ì§„í–‰ ì¤‘ì„ì„ ëª…í™•íˆ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ êµ¬ì¡°ë¡œ ë°”ê¾¸ë©´ â€œë‹¤ë¥¸ íƒ­ìœ¼ë¡œ ì´ë™ â†’ ëŒì•„ì™”ë”ë‹ˆ ì´ˆê¸°í™”â€ ë¬¸ì œëŠ” ì™„ì „íˆ ì‚¬ë¼ì§€ë©°, Sora ì„œë¹„ìŠ¤ì²˜ëŸ¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‘ì—…ì´ ê³„ì†ë˜ê³ , ì™„ë£Œ ì‹œì ì—ë§Œ ê²°ê³¼ë¥¼ ë„ì›Œì¤„ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.