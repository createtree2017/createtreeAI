1. 오디오 URL이 HTML(로그인 페이지) 또는 JSON을 반환하고 있음
원인

로그인 상태가 아닌 경우, /api/music-file/:id 같은 엔드포인트가 로그인 페이지(HTML)를 리다이렉트시키거나 401 JSON 에러를 반환

브라우저는 이 HTML/JSON을 재생 불가능한 포맷으로 인식 ⇒ NotSupportedError

확인 방법

Chrome DevTools ▶ Network 탭에서 <audio> 태그에 설정된 src URL 요청을 찾아보세요.

Response 탭에서 실제로 HTML(로그인 폼)이나 JSON 에러가 내려오는지,
Content-Type 헤더가 text/html 또는 application/json인지 확인

해결 방안

오디오 파일 전용 공개 경로 제공

js
복사
편집
// 예시: 로그인 여부와 무관히 접근 가능한 static 폴더에 저장
app.use('/public/audio', express.static(path.join(__dirname, 'static')));
// 음악 생성 뒤 리다이렉트 대신:
// res.json({ url: `/public/audio/${filename}.mp3` });
인증 쿠키 포함 요청

js
복사
편집
// React side
fetch(audioUrl, { credentials: 'include' })
  .then(r => r.blob()).then(blob => {
    const url = URL.createObjectURL(blob);
    setPlayerSrc(url);
  });
사전 서명(Pre-signed) URL 발급
S3 등에 올린 뒤 1회용 공개 URL을 클라이언트에 내려주면 인증 없이 재생 가능

2. 잘못된 MIME 타입 또는 HTTP 헤더 설정
원인

서버가 Content-Type: text/html 혹은 기본 application/octet-stream으로 응답

브라우저는 이것을 오디오로 인식하지 않아 재생 불가

확인 방법
Network ▶ Response Headers 에서 Content-Type 값 확인

해결 방안

js
복사
편집
// Node.js: music-generation-routes.ts
res.writeHead(200, {
  'Content-Type': 'audio/mpeg',         // or 'audio/mp3'
  'Accept-Ranges': 'bytes',             // 브라우저가 부분 재생 가능
  'Content-Length': stats.size
});
fs.createReadStream(filePath).pipe(res);
3. 스트리밍 대신 잘못된 파일 전송
원인

res.sendFile() 사용 시 내부적으로 Range 요청을 처리하지 못해 브라우저가 전체 파일을 못 받음

혹은 fs.readFile() 후 Buffer를 반환하면서 헤더 설정이 누락

해결 방안

js
복사
편집
// 스트리밍으로 전송
import fs from 'fs';
import path from 'path';

app.get('/api/music-file/:name', (req, res) => {
  const filePath = path.resolve(__dirname, '../static', req.params.name);
  const stat = fs.statSync(filePath);
  res.writeHead(200, {
    'Content-Type': 'audio/mpeg',
    'Content-Length': stat.size,
    'Accept-Ranges': 'bytes'
  });
  fs.createReadStream(filePath).pipe(res);
});
4. 클라이언트 측 <audio> 태그 설정 오류
원인

<audio>에 src가 아닌 잘못된 속성을 사용하거나, blob URL 대신 JSON 객체 전체를 지정

crossOrigin 미설정으로 CORS 문제

확인 방법

React 컴포넌트에서 console.log(playerSrc) 찍어 실제 URL 문자열인지 확인

Network ▶ Request Headers ▶ Origin / Access-Control-Allow-Origin 체크

해결 방안

jsx
복사
편집
// MusicPlayer.tsx 예시
<audio
  controls
  src={playerSrc}              // 반드시 string URL
  crossOrigin="anonymous"      // public URL인 경우
/>