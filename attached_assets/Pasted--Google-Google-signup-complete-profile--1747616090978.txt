ğŸ“¦ [ğŸ”¥ Google ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ì…ë ¥ í™”ë©´ ë¬´í•œë°˜ë³µ ë¬¸ì œ í•´ê²° ì§€ì‹œì„œ]

âœ… ë¬¸ì œ ìš”ì•½:
- Google ë¡œê·¸ì¸ í›„ /signup/complete-profile í™”ë©´ì´ ë°˜ë³µ ë…¸ì¶œë¨
- ì‚¬ìš©ì ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•´ë„ ë‹¤ì‹œ ê°™ì€ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ë¨
- /me APIëŠ” í•­ìƒ needProfileComplete: trueë¥¼ ë°˜í™˜í•¨

âœ… ì›ì¸ ë¶„ì„:
1. ì„œë²„ì—ì„œ í”„ë¡œí•„ ì •ë³´ëŠ” DBì— ì €ì¥ë˜ì§€ë§Œ ì„¸ì…˜(req.session.user ë˜ëŠ” req.user)ì€ ê°±ì‹ ë˜ì§€ ì•ŠìŒ
2. ì„¸ì…˜ ì¿ í‚¤ ì €ì¥ì´ ëˆ„ë½ë˜ê±°ë‚˜, ê°±ì‹ ë˜ì§€ ì•Šì€ ì„¸ì…˜ì´ ê³„ì† ìœ ì§€ë¨
3. í´ë¼ì´ì–¸íŠ¸ëŠ” /me ì‘ë‹µì˜ needProfileComplete ê°’ë§Œ ë³´ê³  ê³„ì† ë¦¬ë””ë ‰ì…˜í•¨

âœ… ë°˜ë“œì‹œ ì ìš©í•´ì•¼ í•  ìˆ˜ì • ì‚¬í•­:

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[1] ğŸ”§ `/complete-profile` API ìˆ˜ì •
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- ì‚¬ìš©ì ì •ë³´ë¥¼ DBì— ì €ì¥í•œ ë’¤, ë‹¤ìŒ ì„¸ì…˜ ê°±ì‹  ì½”ë“œë¥¼ ë°˜ë“œì‹œ ì¶”ê°€:

```ts
req.session.user = {
  ...(req.session.user || {}),
  phoneNumber,
  hospitalId: parseInt(hospitalId),
  dueDate,
  needProfileComplete: false
};

req.session.save((err) => {
  if (err) console.error("ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨:", err);
});
ì¶”ê°€ë¡œ, passport ì‚¬ìš©ìë„ ë‹¤ì‹œ ë¡œê·¸ì¸ ì‹œì¼œ ì„¸ì…˜ì— ì¬ë“±ë¡:

ts
ì½”ë“œ ë³µì‚¬
req.login(updatedUser, (err) => {
  if (err) console.error("ì¬ë¡œê·¸ì¸ ì‹¤íŒ¨:", err);
});
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] ğŸ§  /api/auth/me API ìˆ˜ì •
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

req.userë§Œ ë¯¿ì§€ ë§ê³ , ìµœì‹  DB ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ í”„ë¡œí•„ ì™„ì„± ì—¬ë¶€ë¥¼ íŒë‹¨:

ts
ì½”ë“œ ë³µì‚¬
const userId = req.user?.id || req.session?.user?.id;
const freshUser = await db.query.users.findFirst({
  where: eq(users.id, userId)
});

const needProfileComplete = !freshUser?.phoneNumber || !freshUser?.hospitalId;

return res.json({
  ...sanitizeUser(freshUser),
  needProfileComplete
});
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[3] ğŸŒ í´ë¼ì´ì–¸íŠ¸ ë¦¬ë””ë ‰ì…˜ ë¡œì§ ë³´ê°•
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/me ì‘ë‹µì—ì„œ ì•„ë˜ ì¡°ê±´ì— í•´ë‹¹í•˜ë©´ë§Œ í”„ë¡œí•„ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜:

ts
ì½”ë“œ ë³µì‚¬
if (
  sessionInfo.needProfileComplete === true ||
  !sessionInfo.phoneNumber ||
  !sessionInfo.hospitalId
) {
  window.location.replace("/signup/complete-profile");
}
ë‹¨ìˆœíˆ needSignup ê°™ì€ ì˜ëª»ëœ í”Œë˜ê·¸ ì‚¬ìš©ì€ ê¸ˆì§€ (ìŠ¤í‚¤ë§ˆì— ì—†ìŒ)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[4] ğŸ›¡ ì„¸ì…˜ ì¿ í‚¤ ì²˜ë¦¬ ìµœì í™” (ëª¨ë°”ì¼ í¬í•¨)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì„œë²„ ì¿ í‚¤ ì„¤ì •ì€ í•­ìƒ ë‹¤ìŒê³¼ ê°™ì´ ì¼ê´€ë˜ê²Œ êµ¬ì„±:

ts
ì½”ë“œ ë³µì‚¬
res.cookie("connect.sid", req.sessionID, {
  httpOnly: true,
  secure: true,
  sameSite: "none",
  path: "/",
  maxAge: 30 * 24 * 60 * 60 * 1000
});
ëª¨ë°”ì¼ í™˜ê²½ì—ì„œë„ secure/sameSite ì„¤ì •ì´ ë§ì§€ ì•Šìœ¼ë©´ ì¿ í‚¤ ì €ì¥ ì•ˆ ë¨

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… ì´ ëª¨ë“  ì¡°ì¹˜ë¥¼ ë°˜ì˜í•˜ë©´:

Google ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ì…ë ¥ ì™„ë£Œ ì‹œ ì„¸ì…˜ì´ ì™„ì „íˆ ê°±ì‹ ë¨

/meê°€ ìµœì‹  DB ì •ë³´ ê¸°ì¤€ìœ¼ë¡œ ì‘ë‹µí•¨

í´ë¼ì´ì–¸íŠ¸ëŠ” ì •í™•í•œ ì¡°ê±´ì—ë§Œ ë¦¬ë””ë ‰ì…˜ë˜ë¯€ë¡œ ë¬´í•œë£¨í”„ ë°œìƒí•˜ì§€ ì•ŠìŒ

ğŸ” ëª¨ë“  ìˆ˜ì • í›„ ì„œë²„ ì¬ì‹œì‘ í•„ìˆ˜