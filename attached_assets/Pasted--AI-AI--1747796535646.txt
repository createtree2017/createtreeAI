[최종 작업지시서]
🌙 창조AI 태몽동화 생성 시스템 고도화 개발
🎯 목적
기존 AI 이미지 생성 시스템(스티커, 가족사진, 만삭사진)의 구조를 기반으로
캐릭터 일관성 유지, 스타일 통일, 컷별 상황 표현이 가능한
감성 중심의 "태몽동화 생성 시스템"을 확장 개발한다.

✅ 1. 사용자 입력 흐름
순서	항목	설명
①	사용자 사진 업로드	아기 캐릭터 생성용. 없을 시 스타일별 샘플 이미지 사용
②	아기 이름 입력	고정 텍스트. 컷별 문장 및 프롬프트에 사용됨
③	꿈을 꾼 사람 선택	예: 엄마, 아빠, 할머니 등. 시점 설정용
④	인물 표현 프롬프트	“다정한 아빠와 아기” 등. 컷별 인물 구성 설명
⑤	배경 표현 프롬프트	컷1: 필수, 컷2~4: 생략 시 컷1과 동일하게 처리
⑥	컷 수 선택	1~4컷 중 선택
⑦	컷별 상황 프롬프트	동화 컷별 에피소드 설명. 자유롭게 작성 가능
⑧	스타일 선택	지브리풍, 디즈니풍, 수채화 등. 관리자 등록 항목만 선택 가능

✅ 2. 이미지 생성 프로세스
① 1차 생성: 캐릭터 이미지 생성
업로드된 사진을 기반으로 선택한 스타일에 따라 캐릭터 생성

생성된 이미지 → "캐릭터 참조 이미지"로 저장 (static/uploads/character/...)

② 2차 생성: 태몽 컷별 이미지 생성 (1~4컷)
각 컷마다 다음 정보로 이미지 생성:

text
복사
편집
SystemPrompt = 스타일 프롬프트 + 캐릭터 참조 프롬프트
UserPrompt = 인물 표현 + 배경 표현 + 상황 설명
배경 표현은 컷1 필수, 컷2~4 생략 시 컷1 값 자동 복사

✅ 3. 시스템프롬프트 구성 (2종 분리)
종류	설명	입력 위치	예시
① 스타일 프롬프트	스타일 분위기, 명암, 컬러 톤, 질감 등	스타일 생성 시 (관리자 등록)	Draw in Ghibli style with soft colors and cinematic light.
② 캐릭터 참조 프롬프트	캐릭터 고정 지시 문구	태몽동화 생성 메뉴에 별도 필드 추가 (관리자 편집 가능)	Use this character image as a reference.

→ 시스템프롬프트는 이 둘을 조합하여 컷마다 자동 삽입되어야 함

✅ 4. 관리자 페이지 기능 설계
위치	항목
이미지 생성 > 스타일 관리	스타일별 썸네일 / 프롬프트 / 샘플 캐릭터 이미지 등록
이미지 생성 > 태몽동화 메뉴	시스템프롬프트 2종 등록 UI 제공 (스타일용 + 캐릭터참조용)
하드코딩 금지	모든 스타일/프롬프트/캐릭터 설정은 DB 기반, 코드에 직접 박지 말 것

✅ 5. 프론트엔드 UI 구성
기존 이미지 생성 UI 구조 재사용

아래 항목 추가:

항목	처리
인물 표현 프롬프트	컷별 입력란. 예시 문구 제공 가능
배경 표현 프롬프트	컷1 필수, 컷2~4는 미입력 시 컷1 내용 복사
상황 설명 프롬프트	컷별 입력란. 자유 입력
캐릭터 참조 문구	생성 메뉴 내부에 관리자만 볼 수 있는 설정란 추가

✅ UI 문구 예시:

txt
복사
편집
배경은 첫 컷을 필수로 입력해주세요. 2~4컷은 비워두면 첫 배경을 자동 사용합니다.
✅ 6. 이미지 저장 및 fallback 구조
모든 이미지 /static/uploads/dream-books/{bookId}/{sceneIndex}.png

실패 시 /static/uploads/dream-books/error.png 자동 삽입

fallback 이미지 존재 여부 사전 체크

✅ 7. 필수 구현 조건
항목	설명
참조 이미지 로직	캐릭터 이미지가 존재하면 모든 컷의 시스템프롬프트에 참조 지시 삽입
스타일 선택	관리자 등록된 리스트 기반만 선택 가능. 하드코딩 절대 금지
배경 프롬프트 처리	컷1 필수, 이후 생략 시 컷1 자동 복사 적용
무한 로딩 방지	프롬프트 비어 있거나 에러 이미지 시 로딩 상태 종료 처리

✅ 완료 보고 항목
 관리자 페이지: 스타일/태몽동화 생성 메뉴 캡처

 1차 캐릭터 생성 결과 및 URL

 각 컷 systemPrompt + userPrompt 조합 로그

 이미지 결과물 (4컷 캐릭터 일관성 유지 확인)

 fallback 동작 여부 테스트

⚠️ 주의사항 요약
모든 설정은 관리자 입력 기반 (❌ 하드코딩 절대 금지)

프롬프트는 2종 분리 (스타일 + 캐릭터 참조)

UI/UX는 기존 이미지 생성 흐름과 통일성 유지

참조 이미지 활용 구조는 반드시 systemPrompt에 삽입되도록 구현